# IMAP 

IMAP(Internet Message Access Protocol)，互联网消息访问协议允许客户端访问和操作服务器上的电子邮件消息。

|IMAP版本|协议信息|
|----|----|
|IMAP v4|`https://datatracker.ietf.org/doc/rfc3501/`|

## IMAP 4rev1

IMAP 4rev1 包括以下操作： 创建、删除和重命名邮箱、检查新消息、永久删除消息、设置和清除标志、RFC 2822和RFC 2045解析、搜索和选择性获取消息属性、文本及其部分。

IMAP4rev1中的消息是通过使用数字访问的。这些数字要么是消息序列号，要么是唯一标识符。

IMAP 4rev1支持单个服务器。RFC 2244中讨论了访问配置信息以支持多个IMAP 4rev1服务器的机制。

IMAP4rev1没有指定邮寄邮件的方式;此功能由邮件传输协议(如RFC 2821)处理。

## imap 协议概述

### 链接级别

1. 基于可靠的数据流，例如 TCP 
2. 端口默认 143

### 命令和响应

IMAP4rev1 连接包括：建立客户端/服务器网络连接、来自客户端对服务器的初始问候、客户端/服务器交互。

客户端/服务器交互由客户端命令、服务器数据和服务器完成结果响应组成。

客户端和服务器传输的所有交互都采用以下形式行，即以 CRLF 结尾的字符串。协议接收器IMAP 4rev1 客户端或服务器正在读取一行，或者正在读取已知计数的八位位组序列，后跟一行。

### 客户端协议发送方和服务端协议接收方

客户端命令开始操作。每个客户端命令是以标识符为前缀（通常是短字母数字字符串，例如，A0001、A0002 等）称为“标签”。不同的标签是由客户端为每个命令生成。

客户端必须严格遵循本规范中概述的语法。

## IMAP 过程
```

                   +----------------------+
                   |connection established|
                   +----------------------+
                              ||
                              \/
            +--------------------------------------+
            |          server greeting             |
            +--------------------------------------+
                      || (1)       || (2)        || (3)
                      \/           ||            ||
            +-----------------+    ||            ||
            |Not Authenticated|    ||            ||
            +-----------------+    ||            ||
             || (7)   || (4)       ||            ||
             ||       \/           \/            ||
             ||     +----------------+           ||
             ||     | Authenticated  |<=++       ||
             ||     +----------------+  ||       ||
             ||       || (7)   || (5)   || (6)   ||
             ||       ||       \/       ||       ||
             ||       ||    +--------+  ||       ||
             ||       ||    |Selected|==++       ||
             ||       ||    +--------+           ||
             ||       ||       || (7)            ||
             \/       \/       \/                \/
            +--------------------------------------+
            |               Logout                 |
            +--------------------------------------+
                              ||
                              \/
                +-------------------------------+
                |both sides close the connection|
                +-------------------------------+
```
